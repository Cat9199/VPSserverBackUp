<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الرئيسية</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/web/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/web/dashboard.css') }}">
    <!-- Hotjar Tracking Code for walid elgendy -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:3898861,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
</head>

<body dir="rtl">
    <header>
        <nav>
            <div class="logo">


                <img style=" height: 50px" src="{{ url_for('static',filename='img/logowe.png') }}" />
                <h3>مسيو وليد الجندي</h3>
            </div>
            <div class="header-info">
                <a class="account" href="/settings" >
                    <div class="photo">
                        {% if user.profile_img %}
                        <img src="{{ user.profile_img }}" /> {% else %}
                        <img style="width: 40px; height: 40px" src="{{ url_for('static',filename='img/user.png') }}" /> {% endif %}
                    </div>
                    <div class="username">
                        <h5 class="welcome">مساء الخير</h5>
                        <h5 class="name">{{ user.name }}</h5>
                    </div>
                </a>
                <div class="user-info">
                    <button class="wallet" onclick="showWallet()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g id="solar:wallet-linear">
                            <g id="Group">
                            <path id="Vector" d="M6 8H10" stroke="#262F44" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path id="Vector_2" d="M20.833 9H18.231C16.446 9 15 10.343 15 12C15 13.657 16.447 15 18.23 15H20.833C20.917 15 20.958 15 20.993 14.998C21.533 14.965 21.963 14.566 21.998 14.065C22 14.033 22 13.994 22 13.917V10.083C22 10.006 22 9.967 21.998 9.935C21.962 9.434 21.533 9.035 20.993 9.002C20.959 9 20.917 9 20.833 9Z" stroke="#262F44" stroke-width="1.5"/>
                            <path id="Vector_3" d="M20.965 9C20.887 7.128 20.637 5.98 19.828 5.172C18.657 4 16.771 4 13 4H10C6.229 4 4.343 4 3.172 5.172C2 6.343 2 8.229 2 12C2 15.771 2 17.657 3.172 18.828C4.343 20 6.229 20 10 20H13C16.771 20 18.657 20 19.828 18.828C20.637 18.02 20.888 16.872 20.965 15" stroke="#262F44" stroke-width="1.5"/>
                            <path id="Vector_4" d="M17.9912 12H18.0012" stroke="#262F44" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </g>
                            </g>
                            </svg>
                            
                        <h5>

                            {{user.wallet}} جنيه

                        </h5>
                    </button>
                    <div class="wallet-info" id="wallet-info-id">
                        <h3>إضافة كود جديد</h3>
                        <div class="add-code">
                            <div class="codes">
                                <input type="text" class="otp-input" maxlength="1" oninput="handleInput(1, event)" onpaste="handlePaste(1, event)" />
                                <input type="text" class="otp-input" maxlength="1" oninput="handleInput(2, event)" onpaste="handlePaste(2, event)" />
                                <input type="text" class="otp-input" maxlength="1" oninput="handleInput(3, event)" onpaste="handlePaste(3, event)" />
                                <input type="text" class="otp-input" maxlength="1" oninput="handleInput(4, event)" onpaste="handlePaste(4, event)" /> -
                                <input type="text" class="otp-input" maxlength="1" oninput="handleInput(5, event)" onpaste="handlePaste(5, event)" />
                                <input type="text" class="otp-input" maxlength="1" oninput="handleInput(6, event)" onpaste="handlePaste(6, event)" />
                                <input type="text" class="otp-input" maxlength="1" oninput="handleInput(7, event)" onpaste="handlePaste(7, event)" />
                                <input type="text" class="otp-input" maxlength="1" oninput="handleInput(8, event)" onpaste="handlePaste(8, event)" /> -
                                <input type="text" class="otp-input" maxlength="1" oninput="handleInput(9, event)" onpaste="handlePaste(9, event)" />
                                <input type="text" class="otp-input" maxlength="1" oninput="handleInput(10, event)" onpaste="handlePaste(10, event)" />
                                <input type="text" class="otp-input" maxlength="1" oninput="handleInput(11, event)" onpaste="handlePaste(11, event)" />
                                <input type="text" class="otp-input" maxlength="1" oninput="handleInput(12, event)" onpaste="handlePaste(12, event)" />
                            </div>
                            <button class="paste-code" onclick="pasteText()">
                                    <img src="{{ url_for('static',filename='/img/icons/gala_add.svg')}}" alt="">
                                    <span>
                                        لصق الكود
                                    </span>
                                </button>
                        </div>
                        <button class="check">تحقق من الكود</button>
                    </div>
                    <a class="notification" href="/notification">
                        <img src="{{ url_for('static',filename='/img/icons/ph_bell-bold.svg')}}" />
                        <h5 id="notificationCount">0 </h5>
                    </a>
                </div>
        </nav>
    </header>
    <main>
        <div class="sidebar">
            <div class="top">
                <a class="sidebar-item selected" href="/dashboard">
                    <img src="{{ url_for('static',filename='/img/icons/iconamoon_home.svg')}}" />
                    <h5>الرئيسية</h5>
                </a>
                <a class="sidebar-item" href="/my-courses">
                    <img src="{{ url_for('static',filename='/img/icons/lets-icons_video.svg')}}" />
                    <h5>كورساتي</h5>
                </a>
                <a class="sidebar-item" href="/q-bank">
                    <img src="{{ url_for('static',filename='/img/icons/mingcute_question-line.svg')}}" />
                    <h5>بنك الاسئلة</h5>
                </a>
                <a class="sidebar-item" href="/all-courses">
                    <img src="{{ url_for('static',filename='/img/icons/carbon_course.svg')}}" />
                    <h5>كل الكورسات</h5>
                </a>
                <a class="sidebar-item" href="/revegens">
                    <img src="{{ url_for('static',filename='/img/icons/mingcute_fast-rewind-line.svg')}}" />
                    <h5>المراجعات</h5>
                </a>
                <a class="sidebar-item" href="/askAi">
                    <img src="{{ url_for('static',filename='/img/icons/ai.png')}}" />
                    <h5>اسال الذكاء الاصطناعي</h5>
                </a>
            </div>
            <div class="bottom">
                <a class="sidebar-item" href="/help">
                    <img src="{{ url_for('static',filename='/img/icons/bx_support.svg')}}" />
                    <h5>مساعدة</h5>
                </a>
                <a class="sidebar-item" href="/settings">
                    <img src="{{ url_for('static',filename='/img/icons/carbon_settings.svg')}}" />
                    <h5>الاعدادات</h5>
                </a>
                <a class="sidebar-item" href="/priveci-police">
                    <img src="{{ url_for('static',filename='/img/icons/iconoir_privacy-policy.svg')}}" />
                    <h5>الخصوصية والامان</h5>
                </a>
                <a class="sidebar-item" href="/logout">
                    <img src="{{ url_for('static',filename='/img/icons/ci_exit.svg')}}" />
                    <h5>خروج</h5>
                </a>
            </div>
        </div>
        <div class="content">

            {% block content%} {% endblock %}
        </div>
        <div class="notification-card" id="notification-card-show">
            <a href="./notification.html">
                <img src="{{ url_for('static',filename='/img/icons/notification.svg')}}" alt="">
                <p>عندك رسائل جديدة</p>
                <audio id="notificationSound" src="{{ url_for('static',filename='/sound/notifications-sound.mp3')}}"></audio>
            </a>
        </div>
    </main>

</body>
<script>
    function pasteText() {
        var apiUrl = "/api/check_code/";

        var otpValues = document.querySelectorAll('.otp-input');
        var code = "";

        otpValues.forEach(function(input) {
            code += input.value;
        });

        fetch(apiUrl + code)
            .then(response => response.text()) // Get the response as text
            .then(data => {
                // Log the raw response
                console.log('Raw Response:', data);

                // Try to parse the response as JSON
                try {
                    var jsonData = JSON.parse(data);
                    console.log('Parsed JSON:', jsonData);

                    // Check if the response matches the specified condition
                    if (jsonData.message === 'Code is not used' && jsonData.success === true) {
                        console.log("The message is: " + jsonData.message);
                        // You can add further actions or UI updates here
                    }
                } catch (e) {
                    console.error('Error parsing JSON:', e);
                }
            })
            .catch(error => console.error('Error:', error));
    }

    // You can call this function when the "تحقق من الكود" button is clicked
    document.querySelector('.check').addEventListener('click', pasteText);
</script>


<script>
    function showWallet() {

        let walletInfo = document.getElementById("wallet-info-id");
        if (walletInfo.style.display == "none" || walletInfo.style.display === "") {
            walletInfo.style.display = "flex";
        } else {
            walletInfo.style.display = "none";
        }
    }
    let userId = "{{ user.id }}";
    initialNotificationCount = null

    // function updateNotification() {
    //     fetch(`/api/count_unread_notificashen/${encodeURIComponent(userId)}`)
    //         .then(response => {
    //             if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
    //             return response.json();
    //         })
    //         .then(data => {
    //             if (data && data.count !== undefined) {
    //                 let notification = document.querySelector(".notification h5");
    //                 if (initialNotificationCount === null) {
    //                     initialNotificationCount = 0;
    //                 } else {
    //                     if (initialNotificationCount === 0) {
    //                         initialNotificationCount = data.count;
    //                     } else if (data.count > initialNotificationCount) {
    //                         initialNotificationCount = data.count;
    //                         console.log("new notification");
    //                         showNotification();
    //                         playNotificationSound();

    //                     }
    //                 }
    //                 notification.innerHTML = data.count;
    //                 console.log(data.count);
    //             } else {
    //                 console.error("Unexpected API response format");
    //             }
    //         })
    //         .catch(error => console.error("Error fetching data:", error));
    // }

    // updateNotification();

    // function showNotification() {
    //     let notification = document.getElementById("notification-card-show");
    //     notification.style.left = "20px";
    //     setTimeout(function() {
    //         notification.style.left = "-300px";
    //     }, 3000);
    // }

    function playNotificationSound() {
        let audio = document.getElementById('notificationSound');
        audio.play().catch(error => {
            console.error('Error playing audio:', error);
        });
    }
    async function pasteText() {
        try {
            const pastedText = await navigator.clipboard.readText();

            // Distribute pasted text among input fields
            for (let i = 0; i < pastedText.length && i < 12; i++) {
                const inputField = document.querySelector(`.otp-input:nth-child(${i + 1})`);
                if (inputField) {
                    inputField.value = pastedText[i].replace(/\D/g, '');
                }
            }
        } catch (err) {
            console.error('Unable to read clipboard text:', err);
        }
    }

    function handleInput(index, event) {
        // Ensure the input value is numeric
        event.target.value = event.target.value.replace(/\D/g, '');

        // Move to the next input field if available
        if (event.target.value !== '' && index < 12) {
            document.querySelector(`.otp-input:nth-child(${index + 1})`).focus();
        }

        // Move to the previous input field on backspace
        if (event.inputType === 'deleteContentBackward') {
            if (index > 1 && event.target.value === '') {
                document.querySelector(`.otp-input:nth-child(${index - 1})`).focus();
            } else if (index === 1 && event.target.value === '') {
                document.querySelector(`.otp-input:nth-child(${index})`).focus();
            }
        }
    }

    function handlePaste(index, event) {
        // Get the pasted text
        const pastedText = (event.clipboardData || window.clipboardData).getData('text');

        // Distribute pasted text among input fields
        for (let i = 0; i < pastedText.length && (index + i) <= 12; i++) {
            const inputField = document.querySelector(`.otp-input:nth-child(${index + i})`);
            if (inputField) {
                inputField.value = pastedText[i].replace(/\D/g, '');
            }
        }

    }
</script>
<script>
    window.intercomSettings = {
      api_base: "https://api-iam.intercom.io",
      app_id: "k8dqtpqe",
      name: "{{ user.name }}", // Full name
      user_id: "{{ user.id }}", // a UUID for your user
      email: "{{ user.email }}", // the email for your user
      created_at: "{{created_at }}" // Signup date as a Unix timestamp
    };
  </script>
  
  <script>
  // We pre-filled your app ID in the widget URL: 'https://widget.intercom.io/widget/k8dqtpqe'
  (function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/k8dqtpqe';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(document.readyState==='complete'){l();}else if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
  </script>

</html>